// Available Accounts
// ==================
// (0) 0x4de4d6f678421e38fefdce142b35b22e6a08e0a8 (~1000 ETH) // Contract owner
// (1) 0xd503a470ccfef64f4546287dccb7c8d22dc3c1e7 (~1000 ETH)
// (2) 0x7867592beea1c6ccc25c9e06f305d4f7b1d3833f (~1000 ETH)
// (3) 0x5a1f024860d633c3cfc5cdcd3d6101af40016dc2 (~1000 ETH)
// (4) 0xa301a553a7dbedb4f30cb6d4c914b625c21b43fa (~1000 ETH)
// (5) 0xb17dc2200a42624a866882eec25c088d478c02b9 (~1000 ETH)
// (6) 0xb7a7d77ebc3dfebb583624bc14075c31b0f523b7 (~1000 ETH)
// (7) 0x151ef951fe3e5dc445937ab30467c82d19cad7cb (~1000 ETH)
// (8) 0xcdb54acc131331d45a505275b197126d17a2b838 (~1000 ETH)
// (9) 0x2e90c71dd3c9eb5176c18cf1ea59e507f0ea79cb (~1000 ETH)
// (10) 0xade4b5332bb4f6edc80235dda8c66623bf2bc64a (~1000 ETH) // Customer
// (11) 0xec6104e6f58497053ca7e696bdc5ed463ffa2ab7 (~1000 ETH)
// (12) 0x78a756020605e6a2a9efb6288c735beea4198d85 (~1000 ETH)
// (13) 0xacbf3a2a5a50448915a3806806b639be4f14db23 (~1000 ETH)
// (14) 0x5c479c9749523b605b0a71d38c933fbd22161be6 (~1000 ETH)
// (15) 0x2b7cbd7fe5c3645effe4ea09457a5e6d479babb4 (~1000 ETH)
// (16) 0xeff187a21b84e39cd63abef0ef1c6db4add437ff (~1000 ETH)
// (17) 0xeeca7498fd6522f20cb1f53ca59f97b03b11ad53 (~1000 ETH)
// (18) 0x89daca02ee66792e4bb7a9ec531e5f6b501c5e2c (~1000 ETH)
// (19) 0xfcf8c9e9bfdbaea5f1cfb0b8aed218d1f59aedd6 (~1000 ETH)
// (20) 0x1c7e225484d13d66b67183b9384cd051fb1a6539 (~1000 ETH) // Airlines
// (21) 0xb53377a27f8c04e27c92961f6e2efe286ff710e5 (~1000 ETH)
// (22) 0x9f7fff20b5fc0d3ae1e9ebd900b366a2710a6adb (~1000 ETH)
// (23) 0x5079b2f2a437003d6fd6a0643a67e366a288a568 (~1000 ETH)
// (24) 0xca70435931863e6f49c7e5673644be4f86e81da1 (~1000 ETH)
// (25) 0xff2c59a2ec4dedabc76984ea0bdea3fd1f21eb22 (~1000 ETH)
// (26) 0x8981387a15c87421237c36b8c62b8a9f7673a398 (~1000 ETH)
// (27) 0x08ef80240ec2a47603e85f9744d0e9e5b7d35f82 (~1000 ETH)
// (28) 0x4a9663ae6229506db1d0b2b6375839956b7549f1 (~1000 ETH)
// (29) 0xfb239dfb6900b8f96a142704f96892a62448b36d (~1000 ETH)

// Private Keys
// ==================
// (0) 0xd5e00ef1d058f4c088819ca390151f8305c7179f995754fe1cc951ff9cbececa // Contract owner
// (1) 0xb9a0df8cc8a511fea34c961be4822c126857294efada4a28482ac82a7870be56
// (2) 0xe58af94841b2aebf65f9e87fe777d184c731c41501f367d479911da747297476
// (3) 0xf72ca4275253450fea68df437e851783818848b52ebbe091e2fd7931430966f8
// (4) 0xfa73cb9dea978f8fd6e7e809720812d8343e8736c9bc3c9a4136ec0a4acf0858
// (5) 0x60bda3060d62a5be1d3078fd6d5247dc74a658765076e432945bfa5e69dcb05d
// (6) 0xcd1e086c5a8a8ba51e39b80e07e24911bde16e56a3825fe20ad8560c8f5a70a9
// (7) 0x9a4b9bbbd9d7d2cc7ec32a01cc154cf73e99edeb634be604666e751f1d085a88
// (8) 0x3ba2c9421f19d052417a117b4c8817cfe19ac409bd134f6330f6c973206e5cd2
// (9) 0x97ef758d17769d830eedfbcece06220b88f2c9926fcfc599155d1f9ff612f029
// (10) 0xa75071863c28cfce15462aa5f044ac104596cb154deb42f7f2507af5f1735a64 // Customer
// (11) 0x4d7b368374ff650f3ff7bd3fab2f50e40dfb4ca4504ab2a50408024f32eacd16
// (12) 0xcba0cf8ebdf14daf4beaaf6830beeee69e0fd1d5f5acf58b48d01a9cd75645bc
// (13) 0xcd5a11a4163dce90c934c8075219fa2856a49f5a17da2d7aa26d0e3846dc00ec
// (14) 0xde8a6995dfa9902af6df357d1084f19fafb4db23ce6ef1af5416cde84862bee9
// (15) 0x4e1015d285406b13b44557f549bda31ad901306684fe06db9c4af124097bbcc1
// (16) 0x8cb0fa0f790c0cfe7a0a5aed772c2642d22d3f4516ad4a5bad3572c72bca6ad2
// (17) 0x007f9b1b50029629369f8b367f3df053acdd3b18f57bba86985f05eae4e1db0d
// (18) 0xc61bb7780fecc083a3b22190a6a75cb7359cad76edddf405bfc54094bf87b234
// (19) 0xa53efa101cd9e5e72bdc365552df30628dce959ae8ad91ec5c801932286aabe8
// (20) 0x133e7da4cce264a036f3119e1a00f5264d4684fa0ed7f70c0b1b30d81a23bee7 // Airlines
// (21) 0x16167824d35456a62fd64f3cf07e3280b4f9287ea4bd51d901cde9310ae662a0
// (22) 0x764b635373e9a39afdbc405fe807b047caa1a1955bc9b9cbc46eabb0088e426a
// (23) 0x61f28a33ccbee2cc5fb5d9a203d8d62dca2b2e7474110d5fa3f55a92dc13f52b
// (24) 0x85bd4227a22c7be2679f61ecae1032a02ec21289913f09d161e80216fb75146f
// (25) 0xbf9cb85409c38feb0f810a959b58f3238e3eae00a041d3e4c4bed1901ec07cf9
// (26) 0x1ba3a476c78c31d511e5f3307a2a56f15511960d3b7d20104483c7368af0c9b4
// (27) 0x1461f8733dc364b0de9546f9a907aee4229c1b79be1ce87de2b61cfb0fa39bc6
// (28) 0x240c654496ad03d6d58938d7ac350f18a492890ab8a01b6013520bb56ff06d93
// (29) 0x59dac89b304339d2a580f145defd070aca9736714c7c3e7924503a21a6a8feb5

import FlightSuretyApp from '../../build/contracts/FlightSuretyApp.json'
import Config from './config.json'
import Web3 from 'web3'
import Web3Utils from 'web3-utils'

export default class Contract
{
    // ----------------------------------------------------------------------------

    constructor(network, callback)
    {
        let config = Config[network]
        this.web3 = new Web3(new Web3.providers.WebsocketProvider(config.url))
        this.flightSuretyApp = new this.web3.eth.Contract(FlightSuretyApp.abi, config.appAddress)
        this.initialize(callback)
    }

    // ----------------------------------------------------------------------------

    initialize(callback)
    {
        this.web3.eth.getAccounts((error, accts) => {
            this.owner = accts[0]
            this.getMetaskAccountID()
            callback()
        })
    }

    // ----------------------------------------------------------------------------

    getMetaskAccountID()
    {
        // Retrieving accounts
        let that = this
        this.web3.eth.getAccounts(function(err, res) {
            if (err) {
                console.log('Error:',err)
                return
            }
            that.accounts = res
            web3.eth.defaultAccount = res[0]
            console.log('Accounts:', that.accounts)
            window.ethereum.enable()
        })
    }

    // ----------------------------------------------------------------------------

    isOperational(callback)
    {
       let self = this
       self.flightSuretyApp.methods
            .isOperational()
            .call({
                from: self.owner
            }, callback)
    }

    // ----------------------------------------------------------------------------

    fetchFlightStatus(flight, callback)
    {
        let self = this
        let payload = {
            airline: self.airlines[0],
            flight: flight,
            timestamp: Math.floor(Date.now() / 1000)
        }

        console.log('fetchFlightStatus', payload)

        self.flightSuretyApp.methods
            .fetchFlightStatus(payload.airline, payload.flight, payload.timestamp)
            .send({
                from: self.owner
            }, (error, result) => {
                callback(error, payload)
            })
    }

    // ----------------------------------------------------------------------------

    registerAirline(airline, callback)
    {
		let airlineAddress = null
		if (airline == 'kr_air') {
			airlineAddress = '0xb53377a27f8c04e27c92961f6e2efe286ff710e5'
		}
		else if (airline == 'ph_airline') {
			airlineAddress = '0x9f7fff20b5fc0d3ae1e9ebd900b366a2710a6adb'
		}
		else if (airline == 'cebu_pa') {
			airlineAddress = '0x5079b2f2a437003d6fd6a0643a67e366a288a568'
		}
		else if (airline == 'fr_hop') {
			airlineAddress = '0xca70435931863e6f49c7e5673644be4f86e81da1'
		}
		else if (airline == 'aeroflot_ru') {
			airlineAddress = '0xff2c59a2ec4dedabc76984ea0bdea3fd1f21eb22'
		}
		else if (airline == 'quatar_airline') {
			airlineAddress = '0x8981387a15c87421237c36b8c62b8a9f7673a398'
		}

        let self = this
        let payload = {
            airline: airlineAddress,
        }

        console.log('registerAirline', payload)

        self.flightSuretyApp.methods
            .registerAirline(payload.airline)
            .send({
                from: '0x4de4d6f678421e38fefdce142b35b22e6a08e0a8' // Air france
            }, (error, result) => {
                callback(error, payload)
            })
    }

    // ----------------------------------------------------------------------------

    subscribeInsurance(flight, amount, callback)
    {
        console.log('subscribeInsurance', flight, amount)

        this.flightSuretyApp.methods
            .buy(Web3Utils.fromAscii(flight))
            .send({
                from: this.metamaskAccountID,
                value: Web3Utils.toWei('0.5', 'ether')
            }, (error, result) => {
                callback(error, flight)
            })
    }
}